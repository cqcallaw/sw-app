{% extends "base.html" %}
{% block header %}Sign In{% endblock %}
{% block content %}
<form id="login_form" action="/api/auth/login" method="post" novalidate>
    {{ form.hidden_tag() }}
    <div class="center">
        <p>{{ form.user_id(size=32, placeholder='user id') }}</p>
        <p>{{ form.password(size=32, placeholder='password') }}</p>
        <p id="error"></p>
        <input type="button" onclick="submit_form()" value="Submit" />
    </div>
</form>
<script type="text/javascript">
function submit_form()
{
    console.log('Logging in...')
    const form = $('#login_form')[0]
    const user_id = $('#user_id').val()
    const password = $('#password').val()
    console.log('Using form action ' + form.action)
    console.log('User ID: ' + user_id)
    $.ajax({
        url: form.action,
        method: 'POST',
        contentType: "application/json",
        dataType: 'json',
        data: JSON.stringify ({
            'user_id': user_id,
            'password': password
        }),
        success: function(data, status) {
            console.log("Login success!")
        },
        error: function(xhr, text, status) {
            const reponse_as_json = jQuery.parseJSON(xhr.responseText)
            const message = reponse_as_json['message']
            console.log('Login failure: ' + message)
            $('#error').text('ERROR: ' + message)
        }
    })
    console.log('Login submitted.')
}
</script>
{% endblock %}